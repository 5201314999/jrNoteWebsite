<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>工作中系统架构梳理 | jrNote</title>
    <meta name="description" content="jr 笔记">
    <link rel="icon" href="/jrNoteWebsite/favicon.ico">
    
    <link rel="preload" href="/jrNoteWebsite/assets/css/styles.ef52c15a.css" as="style"><link rel="preload" href="/jrNoteWebsite/assets/js/app.ef52c15a.js" as="script"><link rel="preload" href="/jrNoteWebsite/assets/js/40.3b2545ff.js" as="script"><link rel="prefetch" href="/jrNoteWebsite/assets/css/1.styles.37672f4d.css"><link rel="prefetch" href="/jrNoteWebsite/assets/css/2.styles.56896ed6.css"><link rel="prefetch" href="/jrNoteWebsite/assets/css/3.styles.1e5b2a95.css"><link rel="prefetch" href="/jrNoteWebsite/assets/js/1.37672f4d.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/10.54d0b29b.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/11.507a45cf.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/12.9e788ba2.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/13.a4818e9d.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/14.227214e1.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/15.ddd3f6d7.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/16.279f83ed.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/17.2eeeaf73.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/18.cae9aa9d.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/19.106f0fae.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/2.56896ed6.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/20.94270539.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/21.18fb325d.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/22.60a98c3b.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/23.f0ae317a.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/24.e7900943.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/25.ed4e597b.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/26.46848f48.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/27.1cd75e6a.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/28.60882150.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/29.14caa5b4.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/3.1e5b2a95.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/30.5241ca98.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/31.923877bb.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/32.15c5b3d1.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/33.1cb52141.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/34.dda96f50.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/35.e7449be2.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/36.ceec2b74.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/37.59028316.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/38.5bb0eef8.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/39.357dec72.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/4.d15d075d.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/41.3ec558a7.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/42.9be120e8.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/43.27e584be.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/44.85fab7e3.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/45.f005e7d1.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/46.cf3e199e.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/47.c33c5d66.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/48.1950445a.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/49.9929c7ea.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/5.f43ba467.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/50.e971cff8.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/51.27e59759.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/52.ef08a3c4.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/53.1fe88173.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/54.ecbcad41.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/55.c3d6deb4.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/56.6444e7e5.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/57.267d1ea3.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/58.79ae0eaa.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/59.8626850a.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/6.fb92c824.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/60.c40719a3.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/61.6b280eb8.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/62.99c63958.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/63.a325df46.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/64.9bf05a8f.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/65.ebee5489.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/66.04574448.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/67.de1d3124.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/68.b5719589.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/69.e92c9009.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/7.006cc73e.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/8.5013f130.js"><link rel="prefetch" href="/jrNoteWebsite/assets/js/9.e717d895.js">
    <link rel="stylesheet" href="/jrNoteWebsite/assets/css/1.styles.37672f4d.css"><link rel="stylesheet" href="/jrNoteWebsite/assets/css/2.styles.56896ed6.css"><link rel="stylesheet" href="/jrNoteWebsite/assets/css/3.styles.1e5b2a95.css"><link rel="stylesheet" href="/jrNoteWebsite/assets/css/styles.ef52c15a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/jrNoteWebsite/" class="home-link router-link-active"><!----> <span class="site-name">jrNote</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/jrNoteWebsite/" class="nav-link">首页</a></div><div class="nav-item"><a href="/jrNoteWebsite/docs/" class="nav-link">储物柜</a></div><div class="nav-item"><a href="/jrNoteWebsite/frontend/" class="nav-link">复习</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">更多</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/jrNoteWebsite/goal/goalList.html" class="nav-link">目标清单</a></li><li class="dropdown-item"><!----> <a href="/jrNoteWebsite/more/js/" class="nav-link">js知识</a></li><li class="dropdown-item"><!----> <a href="/jrNoteWebsite/goal/todoList.html" class="nav-link">todoList</a></li></ul></div></div><div class="nav-item"><a href="/jrNoteWebsite/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="https://github.com/5201314999/jrNote" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/jrNoteWebsite/" class="nav-link">首页</a></div><div class="nav-item"><a href="/jrNoteWebsite/docs/" class="nav-link">储物柜</a></div><div class="nav-item"><a href="/jrNoteWebsite/frontend/" class="nav-link">复习</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">更多</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/jrNoteWebsite/goal/goalList.html" class="nav-link">目标清单</a></li><li class="dropdown-item"><!----> <a href="/jrNoteWebsite/more/js/" class="nav-link">js知识</a></li><li class="dropdown-item"><!----> <a href="/jrNoteWebsite/goal/todoList.html" class="nav-link">todoList</a></li></ul></div></div><div class="nav-item"><a href="/jrNoteWebsite/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="https://github.com/5201314999/jrNote" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/jrNoteWebsite/main/2git.html" class="sidebar-link">git 使用总结</a></li><li><a href="/jrNoteWebsite/main/1startKoa.html" class="sidebar-link">Koa2</a></li><li><a href="/jrNoteWebsite/main/7koaRouter.html" class="sidebar-link">koa-router路由中间件</a></li><li><a href="/jrNoteWebsite/main/8koaQuery.html" class="sidebar-link">koa 请求参数接收</a></li><li><a href="/jrNoteWebsite/main/9koaCookiesAndSession.html" class="sidebar-link">koa2 cookies，session</a></li><li><a href="/jrNoteWebsite/main/14koaMysql.html" class="sidebar-link">koa 连接数据库</a></li><li><a href="/jrNoteWebsite/main/3question.html" class="sidebar-link">问题集</a></li><li><a href="/jrNoteWebsite/main/4amazing.html" class="sidebar-link">前端细节优化积累</a></li><li><a href="/jrNoteWebsite/main/5wepy.html" class="sidebar-link">微信小程序开发入门笔记</a></li><li><a href="/jrNoteWebsite/main/6business.html" class="sidebar-link">后台系统业务总结</a></li><li><a href="/jrNoteWebsite/main/10architecture.html" class="sidebar-link">技术上，开发协作问题</a></li><li><a href="/jrNoteWebsite/main/11idea.html" class="sidebar-link">独立思考</a></li><li><a href="/jrNoteWebsite/main/12basicCss.html" class="sidebar-link">mycss note</a></li><li><a href="/jrNoteWebsite/main/15jscod.html" class="sidebar-link">js 基础代码(面试，平时都可以用)🚀</a></li><li><a href="/jrNoteWebsite/main/16graphicDevelop.html" class="sidebar-link">可视化开发</a></li><li><a href="/jrNoteWebsite/main/172019i.html" class="sidebar-link">2019</a></li><li><a href="/jrNoteWebsite/main/18interview.html" class="sidebar-link">面试系列2</a></li><li><a href="/jrNoteWebsite/main/19webrtc.html" class="sidebar-link">webrtc</a></li></ul> </div> <div class="page"> <div class="content"><h2 id="工作中系统架构梳理"><a href="#工作中系统架构梳理" aria-hidden="true" class="header-anchor">#</a> 工作中系统架构梳理</h2> <h3 id="_1-电子会议白板，文档批注-多人管理预研"><a href="#_1-电子会议白板，文档批注-多人管理预研" aria-hidden="true" class="header-anchor">#</a> 1. 电子会议白板，文档批注+多人管理预研</h3> <h4 id="背景"><a href="#背景" aria-hidden="true" class="header-anchor">#</a> 背景</h4> <p>公司领导给我们安排了一个项目任务,开发一个自己公司内部的 “电子白板”，完成之后视情况在富士康内部推广, 确定了 room-----&gt;board ----&gt; 多个文档的架构，权限系统有限剥离，先实现白板核心功能，实现同个房间不同用户的白板内容的同步。需要具备的功能要点如下：</p> <ol><li>文档批注功能，包括对应的绘制工具（线，面，橡皮檫，缩放，拖拽，撤销，前进），文档的上传，下载</li> <li>会议房间管理 (权限模块)</li> <li>会议内容同步（websocket）</li></ol> <h4 id="难点"><a href="#难点" aria-hidden="true" class="header-anchor">#</a> 难点</h4> <ol><li><p>调研了第三方绘制库 konva,faberic, paper</p> <p>结论：采用konva，代码风格符合主流风格</p></li> <li><p>白板如何加载文档的实现</p> <ul><li><p>调研同类产品电子白板，交叉产品</p> <ul><li>OpenMeetings</li> <li>https://www.limitcode.com/public/demo/postil/views/postil.html</li> <li>https://app.conceptboard.com/board/9niz-c2t1-ra35-32o9-au1m#https://app.conceptboard.com/board/9niz-c2t1-ra35-32o9-au1m#</li> <li>Smart 白板功能</li> <li>腾讯在线文档编辑，发现这种编辑模式跟需求不一致，而且后台将office,ppt,excel 转成网页的技术，我们部门不能掌握，市面上大多调用微软服务来加载。</li></ul> <p>结论：前端使用pdf 和 图片操作， 由后台负责文档转换。</p></li></ul></li> <li><p>实现过程</p> <blockquote><p>方案一</p></blockquote> <p>我们先是使用 pdfjs 每页直接渲染进canvas 里，才用了分批加载dom和按可视区渲染dom之后还是会有性能问题，canvas 太多奔溃，好处导出方便，工具在不同canvas 通信复杂度提升, 转而先转图片再加载图片。</p> <blockquote><p>方案二，需求修改</p></blockquote> <p>要求实现效果变成：同时展示多个文档入口（类似书架），点击查看每个文档内容，采用翻页式加载，解决性能问题。</p> <ol><li><p>步骤</p> <ul><li><p>确定一层bgLayer 加载多个Image， 一个Image 放一页，初始化时设定好scale 缩放比。一层 remarkLayer 用于涂鸦，小窗口加载stage 放pdf 首页，其实放合成后的图片也行。</p></li> <li><p>理解 knova 缩放和拖拽的使用原理，结果发现类似图片查看器缩放效果。拖拽则是使用transform。缩放时需要（节流）保证中心点不变(鼠标放大，鼠标点),可以考虑实现鹰眼？（另外一个，可通过加自制滚动条对画布的当前相对位置有一个直观的认识）</p></li> <li><p>需要研究konva 区域的保存。合成背景图和对应区域的remark layer， 发现stage 可以对指定区域生成图片，在这其中，前台想让用户看到的stage 不变，合成图片需要，所以用一层隐藏stage，控制叠放的顺序来生成。文档宽要求适应屏幕宽度，每个屏幕不一样，这样的话需要记录每个文档的宽高，保持绘制轨迹和文档位置比例不变。</p></li> <li><p>不同屏幕大小，比例兼容问题，设计按主讲屏屏幕初始化画布，使用主讲屏幕的比例来初始化其他副屏的画布尺寸，类似屏幕整体的缩放，后续坐标的等比转化处理</p></li> <li><p>钢笔的实现效果（算法类）</p></li></ul> <p>扩展：electron 技术实现多平台？</p></li></ol></li> <li><p>常用工具的使用方法。要实现钢笔和马克笔的效果，需要一定的算法支持, 顺滑度和笔尖样式</p></li></ol> <p>（1）解决问题的能力：
中途其实遇到挺多问题，研究了多种实现方案：
方案1：使用原生canvas 去绘制，然后使用shape 装载，发现顺滑度不一样。
方案2：修改konva 框架线的内部实现，增加自己的绘制方案，然后重新打包
方案3：发现原生api 提供了一种画线demo ，创建一个新的canvas 然后转图片，基于这种方案我们需要结合实际做改动，创建多个image。 同时canvas 需要裁剪，不然选中时绘制区域是全屏。</p> <p>关于铅笔卡顿，锯齿严重问题：</p> <pre><code>1. 发现存在性能问题,对线条进行缓存，同时对计算点也做了个缓存，避免每次都重新计算，效果好了很多，锯齿问题是因为代码有问题同时画了太多遍。
</code></pre> <h4 id="学到的东西"><a href="#学到的东西" aria-hidden="true" class="header-anchor">#</a> 学到的东西</h4> <ol><li><p>实现较复杂的功能时一定要多考虑全面</p> <ol><li>缩略图点开之后，是展开多个stage 还是一个stage (类似tab)</li> <li>改变需求之后如何设置画布，画板填满整个屏幕，文档成为其中一个组件,怎么设计konva的结构(考虑导出保存的实现，缩放)</li> <li>缩放和拖拽的实现效果</li></ol></li> <li><p>对于自己不确定的实现方案，要多跟别人讨论，确定合理的方案，实现难度和工作量都是能大幅度减少的。</p></li> <li><p>注重表达能力和思考能力，乐观情绪的培养提高</p></li> <li><p>对比自己厉害的人，多学习，合理竞争</p></li> <li><p>写代码时存在一个弊端，写完才发现有更简单的方式。打个比方，但是工具的实现方式一开始也不能确定都是一种形式，后续扩展时遇到有些工具写法不一样就容易导致清晰的代码变混乱</p></li></ol> <div class="language- extra-class"><pre class="language-text"><code>    //多个工具只写一套代码，但是后面如何保证所有的工具都可以用这种方式实现。
    delete.init()

    tool.init()
</code></pre></div><ol start="6"><li><p>使用一个mousedown 设置isPainting，mousemove 利用isPainting判断是否在绘制中 比直接mouseup 直接销毁mousemove事件要好，不用反复创建事件订阅。减少开销</p></li> <li><p>对缩放，scale,offset，width，height,x,y 的理解，实际移动时是怎么做</p></li> <li><p>移动端click 有问题，所以别人会封装konva 事件或者fast-click 事件</p></li> <li><p>我把所有的工具都用统一的create,destroy 来写 ，destroy 的stage，layer 一开始由外部传入，考虑了传参的不一致性，使用...params,后面发现destroy 无需传参，只需要用create 保存的stage 和 layer 就可以了。。。这种方法更加清晰</p></li> <li><p>做事方法： <code>预估时间时一定要尽量细，对于未知技术要提出，避免影响工期。同时预留足够的时间，考虑问题全面性</code></p></li> <li><p>写socket 事件时，我先都是先发送，才知道要监听的。这种思路是错的。  emit('getMeet') 在前一句 on('getMeet') 大的坚挺方法可以页面加载完开始监听，代码也会更加清晰，以后多考虑组件销毁时一些监听的销毁</p></li> <li><p>ui 库组件化开发,工具栏样式不够统一时，怎么分成组件,例如poptip 自定义内容,如何实现这个poptip ,有组件确实可以省下很多时间。</p></li> <li><p>写css 时注意多考虑一些动画效果，提高使用效果</p></li> <li><p>主屏，副屏撤销，还原操作。 会有假删除数据,另外一端还原需要用到，所以不能只返回没删除 解决方案：首屏进来的时候把状态为0 的删除掉，解决掉垃圾数据</p></li> <li><p>eventBus.initTool 太多了导致事件监听器存在多个。</p></li> <li><p>性能优化： 防抖，节流， 内存的及时清理，除了常规的，平时项目中也要</p></li></ol> <h3 id="_2-统一管理-单点登录项目流程"><a href="#_2-统一管理-单点登录项目流程" aria-hidden="true" class="header-anchor">#</a> 2. 统一管理,单点登录项目流程</h3> <h3 id="_3-常规后台管理项目"><a href="#_3-常规后台管理项目" aria-hidden="true" class="header-anchor">#</a> 3. 常规后台管理项目</h3> <h3 id="_4-视频会议项目"><a href="#_4-视频会议项目" aria-hidden="true" class="header-anchor">#</a> 4. 视频会议项目</h3> <ul><li>预研 webrtc 项目 ，最后失败了！</li></ul> <h3 id="_5-移动端项目"><a href="#_5-移动端项目" aria-hidden="true" class="header-anchor">#</a> 5. 移动端项目</h3></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2020-1-16 13:46:14</span></div></div> <!----> </div> <!----></div></div>
    <script src="/jrNoteWebsite/assets/js/40.3b2545ff.js" defer></script><script src="/jrNoteWebsite/assets/js/app.ef52c15a.js" defer></script>
  </body>
</html>
