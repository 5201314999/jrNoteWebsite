(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{152:function(a,t,v){"use strict";v.r(t);var e=v(0),_=Object(e.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var a=this,t=a.$createElement,v=a._self._c||t;return v("div",{staticClass:"content"},[v("h2",{attrs:{id:"工作中系统架构梳理"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#工作中系统架构梳理","aria-hidden":"true"}},[a._v("#")]),a._v(" 工作中系统架构梳理")]),a._v(" "),v("h3",{attrs:{id:"_1-电子会议白板，文档批注-多人管理预研"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-电子会议白板，文档批注-多人管理预研","aria-hidden":"true"}},[a._v("#")]),a._v(" 1. 电子会议白板，文档批注+多人管理预研")]),a._v(" "),v("h4",{attrs:{id:"背景"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#背景","aria-hidden":"true"}},[a._v("#")]),a._v(" 背景")]),a._v(" "),v("p",[a._v("公司领导给我们安排了一个项目任务,开发一个自己公司内部的 “电子白板”，完成之后视情况在富士康内部推广, 确定了 room-----\x3eboard ----\x3e 多个文档的架构，权限系统有限剥离，先实现白板核心功能，实现同个房间不同用户的白板内容的同步。需要具备的功能要点如下：")]),a._v(" "),v("ol",[v("li",[a._v("文档批注功能，包括对应的绘制工具（线，面，橡皮檫，缩放，拖拽，撤销，前进），文档的上传，下载")]),a._v(" "),v("li",[a._v("会议房间管理 (权限模块)")]),a._v(" "),v("li",[a._v("会议内容同步（websocket）")])]),a._v(" "),v("h4",{attrs:{id:"难点"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#难点","aria-hidden":"true"}},[a._v("#")]),a._v(" 难点")]),a._v(" "),v("ol",[v("li",[v("p",[a._v("调研了第三方绘制库 konva,faberic, paper")]),a._v(" "),v("p",[a._v("结论：采用konva，代码风格符合主流风格")])]),a._v(" "),v("li",[v("p",[a._v("白板如何加载文档的实现")]),a._v(" "),v("ul",[v("li",[v("p",[a._v("调研同类产品电子白板，交叉产品")]),a._v(" "),v("ul",[v("li",[a._v("OpenMeetings")]),a._v(" "),v("li",[a._v("https://www.limitcode.com/public/demo/postil/views/postil.html")]),a._v(" "),v("li",[a._v("https://app.conceptboard.com/board/9niz-c2t1-ra35-32o9-au1m#https://app.conceptboard.com/board/9niz-c2t1-ra35-32o9-au1m#")]),a._v(" "),v("li",[a._v("Smart 白板功能")]),a._v(" "),v("li",[a._v("腾讯在线文档编辑，发现这种编辑模式跟需求不一致，而且后台将office,ppt,excel 转成网页的技术，我们部门不能掌握，市面上大多调用微软服务来加载。")])]),a._v(" "),v("p",[a._v("结论：前端使用pdf 和 图片操作， 由后台负责文档转换。")])])])]),a._v(" "),v("li",[v("p",[a._v("实现过程")]),a._v(" "),v("blockquote",[v("p",[a._v("方案一")])]),a._v(" "),v("p",[a._v("我们先是使用 pdfjs 每页直接渲染进canvas 里，才用了分批加载dom和按可视区渲染dom之后还是会有性能问题，canvas 太多奔溃，好处导出方便，工具在不同canvas 通信复杂度提升, 转而先转图片再加载图片。")]),a._v(" "),v("blockquote",[v("p",[a._v("方案二，需求修改")])]),a._v(" "),v("p",[a._v("要求实现效果变成：同时展示多个文档入口（类似书架），点击查看每个文档内容，采用翻页式加载，解决性能问题。")]),a._v(" "),v("ol",[v("li",[v("p",[a._v("步骤")]),a._v(" "),v("ul",[v("li",[v("p",[a._v("确定一层bgLayer 加载多个Image， 一个Image 放一页，初始化时设定好scale 缩放比。一层 remarkLayer 用于涂鸦，小窗口加载stage 放pdf 首页，其实放合成后的图片也行。")])]),a._v(" "),v("li",[v("p",[a._v("理解 knova 缩放和拖拽的使用原理，结果发现类似图片查看器缩放效果。拖拽则是使用transform。缩放时需要（节流）保证中心点不变(鼠标放大，鼠标点),可以考虑实现鹰眼？（另外一个，可通过加自制滚动条对画布的当前相对位置有一个直观的认识）")])]),a._v(" "),v("li",[v("p",[a._v("需要研究konva 区域的保存。合成背景图和对应区域的remark layer， 发现stage 可以对指定区域生成图片，在这其中，前台想让用户看到的stage 不变，合成图片需要，所以用一层隐藏stage，控制叠放的顺序来生成。文档宽要求适应屏幕宽度，每个屏幕不一样，这样的话需要记录每个文档的宽高，保持绘制轨迹和文档位置比例不变。")])]),a._v(" "),v("li",[v("p",[a._v("不同屏幕大小，比例兼容问题，设计按主讲屏屏幕初始化画布，使用主讲屏幕的比例来初始化其他副屏的画布尺寸，类似屏幕整体的缩放，后续坐标的等比转化处理")])]),a._v(" "),v("li",[v("p",[a._v("钢笔的实现效果（算法类）")])])]),a._v(" "),v("p",[a._v("扩展：electron 技术实现多平台？")])])])]),a._v(" "),v("li",[v("p",[a._v("常用工具的使用方法。要实现钢笔和马克笔的效果，需要一定的算法支持, 顺滑度和笔尖样式")])])]),a._v(" "),v("p",[a._v("（1）解决问题的能力：\n中途其实遇到挺多问题，研究了多种实现方案：\n方案1：使用原生canvas 去绘制，然后使用shape 装载，发现顺滑度不一样。\n方案2：修改konva 框架线的内部实现，增加自己的绘制方案，然后重新打包\n方案3：发现原生api 提供了一种画线demo ，创建一个新的canvas 然后转图片，基于这种方案我们需要结合实际做改动，创建多个image。 同时canvas 需要裁剪，不然选中时绘制区域是全屏。")]),a._v(" "),v("p",[a._v("关于铅笔卡顿，锯齿严重问题：")]),a._v(" "),v("pre",[v("code",[a._v("1. 发现存在性能问题,对线条进行缓存，同时对计算点也做了个缓存，避免每次都重新计算，效果好了很多，锯齿问题是因为代码有问题同时画了太多遍。\n")])]),a._v(" "),v("h4",{attrs:{id:"学到的东西"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#学到的东西","aria-hidden":"true"}},[a._v("#")]),a._v(" 学到的东西")]),a._v(" "),v("ol",[v("li",[v("p",[a._v("实现较复杂的功能时一定要多考虑全面")]),a._v(" "),v("ol",[v("li",[a._v("缩略图点开之后，是展开多个stage 还是一个stage (类似tab)")]),a._v(" "),v("li",[a._v("改变需求之后如何设置画布，画板填满整个屏幕，文档成为其中一个组件,怎么设计konva的结构(考虑导出保存的实现，缩放)")]),a._v(" "),v("li",[a._v("缩放和拖拽的实现效果")])])]),a._v(" "),v("li",[v("p",[a._v("对于自己不确定的实现方案，要多跟别人讨论，确定合理的方案，实现难度和工作量都是能大幅度减少的。")])]),a._v(" "),v("li",[v("p",[a._v("注重表达能力和思考能力，乐观情绪的培养提高")])]),a._v(" "),v("li",[v("p",[a._v("对比自己厉害的人，多学习，合理竞争")])]),a._v(" "),v("li",[v("p",[a._v("写代码时存在一个弊端，写完才发现有更简单的方式。打个比方，但是工具的实现方式一开始也不能确定都是一种形式，后续扩展时遇到有些工具写法不一样就容易导致清晰的代码变混乱")])])]),a._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[a._v("    //多个工具只写一套代码，但是后面如何保证所有的工具都可以用这种方式实现。\n    delete.init()\n\n    tool.init()\n")])])]),v("ol",{attrs:{start:"6"}},[v("li",[v("p",[a._v("使用一个mousedown 设置isPainting，mousemove 利用isPainting判断是否在绘制中 比直接mouseup 直接销毁mousemove事件要好，不用反复创建事件订阅。减少开销")])]),a._v(" "),v("li",[v("p",[a._v("对缩放，scale,offset，width，height,x,y 的理解，实际移动时是怎么做")])]),a._v(" "),v("li",[v("p",[a._v("移动端click 有问题，所以别人会封装konva 事件或者fast-click 事件")])]),a._v(" "),v("li",[v("p",[a._v("我把所有的工具都用统一的create,destroy 来写 ，destroy 的stage，layer 一开始由外部传入，考虑了传参的不一致性，使用...params,后面发现destroy 无需传参，只需要用create 保存的stage 和 layer 就可以了。。。这种方法更加清晰")])]),a._v(" "),v("li",[v("p",[a._v("做事方法： "),v("code",[a._v("预估时间时一定要尽量细，对于未知技术要提出，避免影响工期。同时预留足够的时间，考虑问题全面性")])])]),a._v(" "),v("li",[v("p",[a._v("写socket 事件时，我先都是先发送，才知道要监听的。这种思路是错的。  emit('getMeet') 在前一句 on('getMeet') 大的坚挺方法可以页面加载完开始监听，代码也会更加清晰，以后多考虑组件销毁时一些监听的销毁")])]),a._v(" "),v("li",[v("p",[a._v("ui 库组件化开发,工具栏样式不够统一时，怎么分成组件,例如poptip 自定义内容,如何实现这个poptip ,有组件确实可以省下很多时间。")])]),a._v(" "),v("li",[v("p",[a._v("写css 时注意多考虑一些动画效果，提高使用效果")])]),a._v(" "),v("li",[v("p",[a._v("主屏，副屏撤销，还原操作。 会有假删除数据,另外一端还原需要用到，所以不能只返回没删除 解决方案：首屏进来的时候把状态为0 的删除掉，解决掉垃圾数据")])]),a._v(" "),v("li",[v("p",[a._v("eventBus.initTool 太多了导致事件监听器存在多个。")])]),a._v(" "),v("li",[v("p",[a._v("性能优化： 防抖，节流， 内存的及时清理，除了常规的，平时项目中也要")])])]),a._v(" "),v("h3",{attrs:{id:"_2-统一管理-单点登录项目流程"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-统一管理-单点登录项目流程","aria-hidden":"true"}},[a._v("#")]),a._v(" 2. 统一管理,单点登录项目流程")]),a._v(" "),v("h3",{attrs:{id:"_3-常规后台管理项目"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-常规后台管理项目","aria-hidden":"true"}},[a._v("#")]),a._v(" 3. 常规后台管理项目")]),a._v(" "),v("h3",{attrs:{id:"_4-视频会议项目"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_4-视频会议项目","aria-hidden":"true"}},[a._v("#")]),a._v(" 4. 视频会议项目")]),a._v(" "),v("ul",[v("li",[a._v("预研 webrtc 项目 ，最后失败了！")])]),a._v(" "),v("h3",{attrs:{id:"_5-移动端项目"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_5-移动端项目","aria-hidden":"true"}},[a._v("#")]),a._v(" 5. 移动端项目")])])}],!1,null,null,null);_.options.__file="0system.md";t.default=_.exports}}]);